apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    openshift.io/cluster-monitoring: ""
    prometheus.cluster-addons-network-operator.io: ""
    k8s-app: cluster-addons-network-operator
  name: prometheus-rules-cluster-addons-network-operator
  namespace: {{ .MonitoringNamespace }}
spec:
  selector:
    matchLabels:
      prometheus.cluster-addons-network-operator.io: ""
  namespaceSelector:
    matchNames:
      - {{ .Namespace }}
  endpoints:
    - port: metrics
      scheme: https
      tlsConfig:
        insecureSkipVerify: true
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    k8s-app: cluster-addons-network-operator
    prometheus.cluster-addons-network-operator.io: ""
  name: prometheus-rules-cluster-addons-network-operator
  namespace: {{ .Namespace }}
spec:
  groups:
    - name: cluster-addons-network-operator.rules
      rules:
        - expr: sum(up{namespace='{{ .Namespace }}', pod=~'cluster-addons-network-operator-.*'})
          record: num_of_running_cnao_operators
        - alert: CnaoOperatorDown
          annotations:
            summary: CNAO operator pod is down.
          expr: num_of_running_cnao_operators == 0
          for: 5m
          labels:
            severity: critical
